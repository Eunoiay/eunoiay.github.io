<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>Hello World | Eunoiayの博客</title><meta name="author" content="Eunoiay"><meta name="copyright" content="Eunoiay"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="Spring6 【第二章】 IoC 之 2.1 IoC基础 ——跟我学Spring3 - 《亿级流量网站架构核心技术》~ - ITeye博客 设计模式六大原则(三)----依赖倒置原则-腾讯云开发者社区-腾讯云 (tencent.com) Spring 中的 ApplicationContext - spring 中文网 (springdoc.cn) 引入 OCP 开闭原则 Open Closed">
<meta property="og:type" content="article">
<meta property="og:title" content="Hello World">
<meta property="og:url" content="http://example.com/2024/08/28/spring6/index.html">
<meta property="og:site_name" content="Eunoiayの博客">
<meta property="og:description" content="Spring6 【第二章】 IoC 之 2.1 IoC基础 ——跟我学Spring3 - 《亿级流量网站架构核心技术》~ - ITeye博客 设计模式六大原则(三)----依赖倒置原则-腾讯云开发者社区-腾讯云 (tencent.com) Spring 中的 ApplicationContext - spring 中文网 (springdoc.cn) 引入 OCP 开闭原则 Open Closed">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/static/img/avatar.jpg">
<meta property="article:published_time" content="2024-08-28T07:57:23.321Z">
<meta property="article:modified_time" content="2024-08-28T08:00:25.752Z">
<meta property="article:author" content="Eunoiay">
<meta property="article:tag" content="ssm">
<meta property="article:tag" content="spring">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/static/img/avatar.jpg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://example.com/2024/08/28/spring6/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="stylesheet" href="/css/index.css?v=4.13.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.5.1/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.33/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":300,"languages":{"author":"作者: Eunoiay","link":"链接: ","source":"来源: Eunoiayの博客","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'fancybox',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.11.1/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: true,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: true,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Hello World',
  isPost: true,
  isHome: false,
  isHighlightShrink: true,
  isToc: true,
  postUpdate: '2024-08-28 16:00:25'
}</script><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
        if (t === 'dark') activateDarkMode()
        else if (t === 'light') activateLightMode()
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><meta name="generator" content="Hexo 7.3.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/static/img/avatar.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">2</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">2</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">1</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-archive"></i><span> 目录</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-heart"></i><span> 归档</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 其它</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/Gallery/"><i class="fa-fw fas fa-images"></i><span> 图片</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li><li><a class="site-page child" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友情链接</span></a></li></ul></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/static/img/default_cover.png')"><nav id="nav"><span id="blog-info"><a href="/" title="Eunoiayの博客"><span class="site-name">Eunoiayの博客</span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-archive"></i><span> 目录</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-heart"></i><span> 归档</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 其它</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/Gallery/"><i class="fa-fw fas fa-images"></i><span> 图片</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li><li><a class="site-page child" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友情链接</span></a></li></ul></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">Hello World</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="fa-fw post-meta-icon far fa-calendar-alt"></i><span class="post-meta-label">发表于</span><time datetime="2024-08-28T07:57:23.321Z" title="发表于 2024-08-28 15:57:23">2024-08-28</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Java-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">Java 学习笔记</a></span></div><div class="meta-secondline"></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1>Spring6</h1>
<p><a target="_blank" rel="noopener" href="https://www.iteye.com/blog/jinnianshilongnian-1413846">【第二章】 IoC 之 2.1 IoC基础 ——跟我学Spring3 - 《亿级流量网站架构核心技术》~ - ITeye博客</a></p>
<p><a target="_blank" rel="noopener" href="https://cloud.tencent.com/developer/article/1833682">设计模式六大原则(三)----依赖倒置原则-腾讯云开发者社区-腾讯云 (tencent.com)</a></p>
<p><a target="_blank" rel="noopener" href="https://springdoc.cn/spring-application-context/">Spring 中的 ApplicationContext - spring 中文网 (springdoc.cn)</a></p>
<h2 id="引入">引入</h2>
<h3 id="OCP">OCP</h3>
<p>开闭原则 Open Closed Principle（OCP）是面向对象设计原则中的 <strong>最基本的原则</strong></p>
<blockquote>
<p>Software entities like classes, modules and functions should be open for extension but closed for modifications<br>
软件实体（如类、模块和函数）应该允许扩展，禁止修改</p>
</blockquote>
<p>在以后的学习中，我们可以体会到遵守 OCP 的优势：</p>
<ol>
<li>通过测试的程序仍然能够正常运行</li>
<li>在 OCP 设计中，业务逻辑通过原子逻辑组合而来，粒度越小，代码复用的可能性就越大</li>
<li>项目低耦合，方便维护</li>
</ol>
<h3 id="DIP">DIP</h3>
<p>依赖倒置原则 Dependency Inversion Principle（DIP）是面向对象设计原则之一</p>
<blockquote>
<p>依赖倒转原则就是要针对接口编程，不要针对实现编程。也就是说，应当使用接口或者抽象类进行 <strong>变量的类型声明</strong>，<strong>参数的类型声明</strong>，<strong>方法的返回类型说明</strong>，<strong>以及数据类型的转换</strong> 等。</p>
</blockquote>
<p>依赖：A uses B，则 A 与 B 之间有依赖</p>
<p>违背 DIP 依赖倒置原则的设计，被称为 <strong>侵入式设计</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServlet</span> <span class="keyword">extends</span> <span class="title class_">Servlet</span> &#123;</span><br><span class="line">    <span class="comment">// 非侵入式设计</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doSomething</span><span class="params">(ServletRequest request)</span> &#123;&#125;</span><br><span class="line">    <span class="comment">// 侵入式设计：ServletRequest 的实现类 HttpServletRequest 侵入了 Servlet 的实现类</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doOther</span><span class="params">(HttpServletRequest request)</span> &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="IoC-和-DI">IoC 和 DI</h3>
<p>控制反转 Inversion of Control（IoC）是一种设计思想。依赖注入 Dependency Injection（DI）是 IoC 思想的要求之一</p>
<p>在 IoC 设计思想中，将一些对象交给其它程序（术语形象地称之为 IoC 容器）来控制，包括</p>
<ol>
<li>控制对象的创建与销毁</li>
<li>控制对象之间的 <strong>依赖</strong> 关系，由 IoC 容器 <strong>注入</strong>（给对象的属性赋值）</li>
</ol>
<p><strong>对 “反转” 的理解：</strong><br>
当应用程序 app 需要使用一个对象时，不再是 app 直接 <code>new</code> 一个对象，而是由 IoC 容器来控制，应用程序从 <strong>主动创建</strong>，转变为 <strong>被动获取</strong>，“反转” 了控制权。站在开发者的角度讲，不需要在开发 app 中关注大量与业务逻辑不相关的代码。</p>
<p>举个例子，来加深理解<br>
设计 UserServiceImpl 类时，为满足 OCP 和 DIP，我们通过接口声明其依赖的 DAO 层对象</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    UserDao userDao;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>我们当然可以通过 constuctor 或 setter 来指定 UserService 对象所依赖 UserDao 对象，但这样一来，我们需要修改程序源码，这再次违背了 OCP，且编码过程中会出现大量与业务逻辑不相关的代码。</p>
<p>例如，在原生 JDBC 技术中，若想实现对数据库的操作，需要以下步骤获取 <code>PreparedStatement</code> 对象</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Properties</span> <span class="variable">info</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Properties</span>();</span><br><span class="line">info.load(Files.newInputStream(Paths.get(<span class="string">&quot;src/mysql.properties&quot;</span>)));</span><br><span class="line"></span><br><span class="line"><span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> info.getProperty(<span class="string">&quot;url&quot;</span>);</span><br><span class="line"><span class="type">String</span> <span class="variable">user</span> <span class="operator">=</span> info.getProperty(<span class="string">&quot;user&quot;</span>);</span><br><span class="line"><span class="type">String</span> <span class="variable">password</span> <span class="operator">=</span> info.getProperty(<span class="string">&quot;password&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> DriverManager.connect(url, user, password);</span><br><span class="line"><span class="type">PreparedStatement</span> <span class="variable">statement</span> <span class="operator">=</span> connection.prepareStatement(sql);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 业务逻辑</span></span><br><span class="line"><span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;select name, pwd from admin where name = ? and pwd = ?&quot;</span>;</span><br><span class="line"><span class="type">PreparedStatement</span> <span class="variable">statement</span> <span class="operator">=</span> conn.prepareStatement(sql);</span><br></pre></td></tr></table></figure>
<p>为了简化以上代码，我们设计了 JDBCUtils 工具类，来一步到位加载配置文件，并获取 Connection 对象。</p>
<p>我们很容易的想到，能否开发一个程序（IoC 容器），帮助我们创建、销毁对象，同时维护（控制）对象的依赖关系呢？<br>
Spring 框架实现了 IoC 容器，它通过 XML 配置文件或注解的方式实现对 Java 对象的控制</p>
<h3 id="Spring6-八大模块">Spring6 八大模块</h3>
<img src="D:\Program Files (x86)\Typora\image\image-20240804164247965.png" alt="image-20240804164247965" style="zoom: 67%;" />
<h3 id="Spring-项目搭建">Spring 项目搭建</h3>
<ol>
<li>
<p>IDEA 创建空项目：配置项目结构 JDK 17、编译器 JDK 17</p>
</li>
<li>
<p>设置 Maven：<code>Settings -&gt; Build, Execution, Deployment -&gt; Build Tools -&gt; Maven</code><br>
配置 <code>Maven home path</code> 以及 <code>User settings file</code></p>
<p>![image-20240826233020611](D:\Program Files (x86)\Typora\image\image-20240826233020611.png)</p>
</li>
<li>
<p>配置 <code>pom.xml</code> 文件，引入 <code>Spring Context 6.x</code> 依赖，<code>Junit 5.x</code> 依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">spring-version</span>&gt;</span>6.1.11<span class="tag">&lt;/<span class="name">spring-version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">junit.version</span>&gt;</span>5.10.2<span class="tag">&lt;/<span class="name">junit.version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- Spring Context --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- Spring 框架的其它基础依赖会一起引入 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-context<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring-version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">    <span class="comment">&lt;!-- Junit 5.x --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.junit.jupiter<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit-jupiter-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;junit.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>新建配置文件 <code>spring.xml</code>，该文件放在类的根路径下（resouces 中的文件编译后会自动放在类的根路径中）<br>
命名不做要求，一般为 <code>spring.xml</code> 或 <code>beans.xml</code></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans 														   http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<h2 id="Spring-对-IoC-的实现">Spring 对 IoC 的实现</h2>
<p>Spring 框架实现了 IoC 容器，被 Spring 管理的对象，被称 Bean。可以通过 XML 配置文件或注解的方式，让 Spring 控制 Bean，包括</p>
<ol>
<li>控制 Bean 的创建与销毁</li>
<li>依赖注入</li>
</ol>
<p>**总结：**Spring 容器通过读取配置元数据（XML 文件，注解，Java 配置类）来获取管理 Bean 的信息及方式</p>
<h3 id="Spring-IoC-容器接口">Spring IoC 容器接口</h3>
<p><code>org.springframework.beans</code> 和 <code>org.springframework.context</code> 包是 Spring Framework 的 IoC 容器的基础包。</p>
<p>在 Spring 框架中，<code>BeanFactory</code> 和 <code>ApplicationContext</code> 接口，代表 Spring IoC 容器。其中，<code>BeanFactory</code> 是访问 Spring IoC 容器的根接口。它提供了管理 Bean 的基本功能。</p>
<p>而 <code>ApplicationContext</code> 是 <code>BeanFactory</code> 的子接口，额外提供了更多面向企业的特定功能：</p>
<ol>
<li>更容易与 Spring 的 AOP 功能集成</li>
<li>消息资源处理（用于国际化）</li>
<li>特定于应用程序给予此接口实现，例如Web 应用程序的 <code>WebApplicationContext</code></li>
</ol>
<p>我们一般将 <code>ApplicationContext</code> 作为默认的 Spring IoC 容器来使用，其实现类有，</p>
<table>
<thead>
<tr>
<th>类型名</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>ClassPathXmlApplicationContext</td>
<td>通过读取类路径下的 XML 格式的配置文件创建 IoC 容器对象</td>
</tr>
<tr>
<td>FileSystemXmlApplicationContext</td>
<td>通过读取文件系统路径下 XML 格式的配置文件创建 IoC 容器对象</td>
</tr>
<tr>
<td>AnnotationConfigApplicationContext</td>
<td>通过读取 Java 配置类创建 IOC 容器对象</td>
</tr>
<tr>
<td>WebApplicationContext</td>
<td>基于 Web 环境创建 IoC 容器对象，并将对象引入存入 ServletContext 域中</td>
</tr>
</tbody>
</table>
<blockquote>
<p>有了上述知识，我们就可以知道 <code>spring.xml</code> 是应用程序向 <code>ApplicationoContext</code> 容器提供管理 Bean 的配置的</p>
</blockquote>
<h3 id="通过-Ioc-容器创建、销毁对象">通过 Ioc 容器创建、销毁对象</h3>
<p>Spring Bean 配置由一个或多个 Bean 声明/定义（Declaration/Definition）组成</p>
<p>在 <code>spring.xml</code> 通过 <code>&lt;bean&gt;</code> 标签声明 Spring 容器管理的对象</p>
<ol>
<li>id：Bean 的唯一标识，不能重复，一些标签中可以给 <code>ref</code> 属性赋值 <code>id</code> 来引用 xml 中声明的 Bean 对象</li>
<li>class：类的全限定类名 (Fully Qualified Class Name)</li>
<li>scope：Bean 的作用域，默认值为 <code>scope=&quot;singleton&quot;</code>，表示单例模式</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;userDaoBean&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.eunoiay.spring6.dao.impl.UserDaoImplForMysql&quot;</span> <span class="attr">scope</span>=<span class="string">&quot;singleton&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>
<p>创建 IoC 容器后，使用 IoC 容器来获取 Bean</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringTest</span> &#123;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testGetBeanBySpringIocContainer</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// 1. 获取 Spring 容器对象</span></span><br><span class="line">        <span class="comment">// ClassPathXmlApplicationContext 专门从类路径中加载 Spring 配置文件的 Spring 上下文对象</span></span><br><span class="line">        <span class="comment">// 启动 Spring 容器，解析 spring.xml 文件，并实例化所有 Bean 对象存入 Spring 容器中</span></span><br><span class="line">        <span class="type">ApplicationContext</span> <span class="variable">app</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;spring.xml&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 2.1 根据 Bean 的唯一标识 id 获取 Bean 对象</span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">userDaoObject</span> <span class="operator">=</span> app.getBean(<span class="string">&quot;userDaoBean&quot;</span>);</span><br><span class="line">        <span class="comment">// 2.2 根据 Class 来获取 Bean，要求 IoC 容器只管理一个该类型的 Bean 对象</span></span><br><span class="line">        <span class="type">UserDao</span> <span class="variable">userDaoByClass</span> <span class="operator">=</span> app.getBean(UserDao.class);</span><br><span class="line">        <span class="comment">// 2.3 根据 id + Class 获取 Bean</span></span><br><span class="line">        <span class="type">UserDao</span> <span class="variable">userDao</span> <span class="operator">=</span> app.getBean(<span class="string">&quot;userDaoBean&quot;</span>, UserDao.class);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 3. 使用 Bean 对象</span></span><br><span class="line">        List&lt;User&gt; userList = userDao.listUser();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Spring 框架默认用无参构造器创建对象，且默认为单例模式（仅创建一个实例，在初始化 ApplicationContext 对象时实例化）<br>
详细请看 <a href="">Bean 的生命周期</a></p>
</blockquote>
<h3 id="依赖注入">依赖注入</h3>
<p>Spring 框架中依赖注入（对 Bean 对象属性赋值）常见的形式包括</p>
<ol>
<li>set 注入：通过反射机制，调用对象的 setter 完成对属性的赋值，在 <code>spring.xml</code> 中通过 <code>&lt;property&gt;</code> 子标签完成 set 注入的配置</li>
<li>构造注入：调用构造器完成对属性的赋值</li>
</ol>
<h4 id="引入-2">引入</h4>
<p>在前面，我们通过 <code>&lt;bean&gt;</code> 标签声明 spring 容器管理的对象</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;userDaoBean&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.eunoiay.spring6.dao.impl.UserDaoImplForMysql&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>
<p>上述声明包含以下几点额外信息：</p>
<ol>
<li>bean 的作用域为单例，会在在初始化 <code>ApplicationContext</code> 对象时实例化</li>
<li>spring 容器使用无参构造器创建对象</li>
</ol>
<p>那么如何配置构造器信息，以及创建对象后，需要调用的 setter 呢？</p>
<ul>
<li><code>&lt;constructor-arg&gt;</code> 子标签来配置实例化 bean 时构造器的参数</li>
<li><code>&lt;property&gt;</code> 子标签来配置实例化后，需要调用的 setter 来给属性赋值</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 声明 bean 实例化时调用的构造器，以及实例化后调用的 setter --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;user&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.eunoiay.spring6.pojo.User&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 传递构造器参数 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 通过 index, name, type 属性指定构造器参数的下标，参数名，参数类型 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 未规定参数顺序时，spring6 会优化参数传递的顺序，不存在歧义即可 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- value/ref 属性分别给简单类型/引用类型赋值 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">index</span>=<span class="string">&quot;0&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;userDao&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;admin&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">type</span>=<span class="string">&quot;int&quot;</span> <span class="attr">value</span>=<span class="string">&quot;21&quot;</span>/&gt;</span></span><br><span class="line">	</span><br><span class="line">    <span class="comment">&lt;!-- 追溯源码可以发现，name 属性的值是 setter 去掉 set 后首字母小写的值 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;123&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="注入简单类型值">注入简单类型值</h4>
<p>在上面的学习中，我们知道通过 <code>value/ref</code> 属性分别给简单类型/非简单类型赋值</p>
<h5 id="查看简单类型">查看简单类型</h5>
<p>那么 spring 容器中的简单类型包括哪些呢？<br>
Spring 框架中的抽象工具类 BeanUtils 中的静态方法 <code>isSimpleValueType()</code> 罗列了所有的简单值类型</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">isSimpleValueType</span><span class="params">(Class&lt;?&gt; type)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> !isVoidType(type) &amp;&amp; </span><br><span class="line">        (isPrimitiveOrWrapper(type) || </span><br><span class="line">         Enum.class.isAssignableFrom(type) || </span><br><span class="line">         CharSequence.class.isAssignableFrom(type) || </span><br><span class="line">         Number.class.isAssignableFrom(type) || </span><br><span class="line">         Date.class.isAssignableFrom(type) || </span><br><span class="line">         Temporal.class.isAssignableFrom(type) || </span><br><span class="line">         ZoneId.class.isAssignableFrom(type) || </span><br><span class="line">         TimeZone.class.isAssignableFrom(type) || </span><br><span class="line">         File.class.isAssignableFrom(type) || </span><br><span class="line">         Path.class.isAssignableFrom(type) || </span><br><span class="line">         Charset.class.isAssignableFrom(type) || </span><br><span class="line">         Currency.class.isAssignableFrom(type) || </span><br><span class="line">         InetAddress.class.isAssignableFrom(type) || </span><br><span class="line">         URI.class == type || </span><br><span class="line">         URL.class == type || </span><br><span class="line">         UUID.class == type || </span><br><span class="line">         Locale.class == type || </span><br><span class="line">         Pattern.class == type || </span><br><span class="line">         Class.class == type);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="配置-XML-文件">配置 XML 文件</h5>
<p>spring.xml 约束中，<code>&lt;property&gt;</code> 子标签可以成对儿出现，属性赋值的方式是多样的，例如</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;user&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.eunoiay.spring6.pojo.User&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 通过 value 属性赋值 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Eunoiay&quot;</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 通过 &lt;value&gt; 标签赋值 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;age&quot;</span>&gt;</span></span><br><span class="line">    	<span class="tag">&lt;<span class="name">value</span>&gt;</span>20<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h5 id="注入空字符串-“”">注入空字符串 “”</h5>
<p>给 String 对象注入空串 <code>&quot;&quot;</code> 或 空值 <code>null</code> 的方式也是多样的</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;user&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.eunoiay.spring6.pojo.User&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 方式一 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;&quot;</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 方式二  --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span>&gt;</span></span><br><span class="line">    	<span class="tag">&lt;<span class="name">value</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h5 id="注入空值-null">注入空值 null</h5>
<p>不使用 <code>&lt;property&gt;</code> 标签调用 setter 默认就是 <code>null</code>，但是也可以显示声明</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;user&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.eunoiay.spring6.pojo.User&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 显示声明为 null --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span>&gt;</span></span><br><span class="line">    	<span class="tag">&lt;<span class="name">null</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h5 id="注入-java-util-Date-简单类型值">注入 java.util.Date 简单类型值</h5>
<p>注入格式需要满足 Date 类的实例方法 toString()，因此通常 Date 类属性使用 <code>ref</code> 属性注入</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- Format: Wed Aug 07 19:14:42 CST 2024 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;user&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.eunoiay.spring6.pojo.User&quot;</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;birthday&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Wed Aug 07 19:14:42 CST 2024&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h5 id="值中含有特殊符号">值中含有特殊符号</h5>
<p>XML 中有 5 个特殊字符，分别是 <code>[&lt;, &gt;, ', &quot;, &amp;]</code>，有两种解决方法：</p>
<ol>
<li>
<p>使用转义字符代替：分别对应 <code>[&amp;gs;, &amp;lt;, &amp;apos;, &amp;quot;, &amp;amp;]</code></p>
</li>
<li>
<p>使用 <code>&lt;value&gt;</code> 子标签，将含有特殊符号的字符串放到<code>&lt;![CDATA[]]&gt;</code> 之中，<code>&lt;![CDATA[]]&gt;</code> 内数据不会被 XML 文件解析器解析。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;user&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.eunoiay.spring6.pojo.User&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;condition&quot;</span>&gt;</span></span><br><span class="line">         <span class="comment">&lt;!-- 只能使用 &lt;value&gt; 标签 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">value</span>&gt;</span>&lt;![CDATA[2 &lt; 3]]&gt;<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<h4 id="注入非简单类型值">注入非简单类型值</h4>
<h5 id="外部-bean">外部 bean</h5>
<p>通过 <code>ref</code> 属性引用 bean 时，需要在外部声明引用的 bean</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 外部 bean --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;userDaoBean&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.eunoiay.spring6.dao.impl.UserDaoImplForMysql&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;userServiceBean&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.eunoiay.spring6.service.impl.UserServiceImpl&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- name: 提供的 setter 的名字，去掉 set，首字母小写 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 通过 ref 属性引用外部声明的 bean --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;userDao&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;userDaoBean&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h5 id="内部-bean">内部 bean</h5>
<p>spring 还提供了在内部声明 bean 的方式（很灵活）</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;userServiceBean&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.eunoiay.spring6.service.impl.UserServiceImpl&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;userDao&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 在 &lt;property&gt; 标签中定义 &lt;bean&gt; 子标签 --&gt;</span></span><br><span class="line">    	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;com.eunoiay.spring6.dao.impl.UserDaoImplForMysql&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h5 id="数组-集合">数组/集合</h5>
<p>对于数组 <code>Array</code> 和集合 <code>List, Set, Map</code>，srping 分别提供了 <code>&lt;array&gt;, &lt;list&gt;, &lt;set&gt;, &lt;map&gt;</code> 子标签</p>
<p><code>&lt;array&gt;, &lt;list&gt;, &lt;set&gt;</code> 用法相同</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;user&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.eunoiay.spring6.pojo.User&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;favariteFoods&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">array</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 简单类型值，使用 &lt;value&gt; 标签 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>鸡排<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>汉堡<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">array</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;friends&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">array</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 非简单类型值，使用 &lt;ref&gt; 标签，设置 bean 属性，对应外部 bean 的 id --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">ref</span> <span class="attr">bean</span>=<span class="string">&quot;Alice&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">ref</span> <span class="attr">bean</span>=<span class="string">&quot;Bob&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">array</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><code>&lt;map&gt;</code> 标签使用 <code>&lt;entry&gt;</code> 来配置，而非 <code>value</code></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">map</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">&quot;1&quot;</span> <span class="attr">value</span>=<span class="string">&quot;520&quot;</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--若不是简单类型，则对应使用 key-ref/value-ref 属性--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key-ref</span>=<span class="string">&quot;keyId&quot;</span> <span class="attr">value-ref</span>=<span class="string">&quot;valueId&quot;</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- entry 也支持双标签，配置内部 bean --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">&quot;inner&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;com.eunoiay.spring.pojo.User&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">entry</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">map</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h5 id="注入-Properties">注入 Properties</h5>
<p>Properties 继承了 <code>Java.util.Hashtable</code>，所以 Properties 也是一个 Map 集合，配置方式有所不同</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"> <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;user&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.eunoiay.spring6.pojo.User&quot;</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;info&quot;</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">props</span>&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">&quot;driver&quot;</span>&gt;</span>com.mysql.cj.jdbc.Driver<span class="tag">&lt;/<span class="name">prop</span>&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">&quot;url&quot;</span>&gt;</span>jdbc:mysql://localhost:3306/spring<span class="tag">&lt;/<span class="name">prop</span>&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">&quot;username&quot;</span>&gt;</span>root<span class="tag">&lt;/<span class="name">prop</span>&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">&quot;password&quot;</span>&gt;</span>123<span class="tag">&lt;/<span class="name">prop</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;/<span class="name">props</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="级联属性">级联属性</h4>
<p>和 Java 访问对象属性一样，通过 <code>.</code> 可以给级联属性赋值，举个例子</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;clazz&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.eunoiay.spring6.pojo.Clazz&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;teacher.age&quot;</span> <span class="attr">value</span>=<span class="string">&quot;25&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="自动装配">自动装配</h4>
<p>Spring 容器可以完成自动化的注入，称为自动装配。通过配置 <code>autowire</code> 属性，可实现根据 <strong>名字</strong> 或 <strong>类型</strong> 的自动装配。</p>
<p>autowire 属性有两种取值 <code>autowire = [&quot;byName&quot;, &quot;byType&quot;]</code></p>
<h5 id="byName">byName</h5>
<p>**要求：**外部 bean 的 id 要与引用它的 bean 的 setter 匹配</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;user&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.eunoiay.spring6.pojo.User&quot;</span> <span class="attr">autowire</span>=<span class="string">&quot;byName&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- id 不能随便写，要与对应的 setter 匹配，即与 setBirthday() 方法名对应 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;birthday&quot;</span> <span class="attr">class</span>=<span class="string">&quot;java.util.Date&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>
<h5 id="byType">byType</h5>
<p>**要求：**在 <strong>有效的配置文件</strong> （构造 ApplicationContext 时用到的配置文件）中，某种类型的 Bean 实例只能有一个</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;user&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.eunoiay.spring6.pojo.User&quot;</span> <span class="attr">autowire</span>=<span class="string">&quot;byType&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 该类型实例不能有多个，且需要提供对应的 setter --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;java.util.Date&quot;</span>/&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- Error --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;otherDate&quot;</span> <span class="attr">class</span>=<span class="string">&quot;java.util.Date&quot;</span>&gt;</span>  </span><br></pre></td></tr></table></figure>
<h4 id="p-命名空间-简化-set-注入">p 命名空间 - 简化 set 注入</h4>
<p>可以通过 p 命名空间，来简化 set 注入的声明语句</p>
<ol>
<li>
<p>在 XML 头部信息中引入 <code>p 命名空间</code></p>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;</span><br><span class="line">       xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><br><span class="line"><span class="addition">+	   xmlns:p=&quot;http://www.springframework.org/schema/p&quot;</span></span><br><span class="line">       xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans 														   http://www.springframework.org/schema/beans/spring-beans.xsd&quot;&gt;</span><br><span class="line">&lt;/beans&gt;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>使用方法：<code>p:属性名 = &quot;属性值&quot;</code>，<code>p:属性名-ref = &quot;bean.id&quot;</code></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;user&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.eunoiay.spring6.pojo.User&quot;</span> <span class="attr">p:name</span>=<span class="string">&quot;Eunoiay&quot;</span> <span class="attr">p:age</span>=<span class="string">&quot;100&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<h4 id="c-命名空间-简化构造注入">c  命名空间 - 简化构造注入</h4>
<p>可以通过 c 命名空间，来简化构造器注入时的声明</p>
<ol>
<li>
<p>在 XML 头部信息中引入 <code>c 命名空间</code></p>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;</span><br><span class="line">       xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><br><span class="line"><span class="addition">+	   xmlns:c=&quot;http://www.springframework.org/schema/c&quot;</span></span><br><span class="line">       xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans 													 	   http://www.springframework.org/schema/beans/spring-beans.xsd&quot;&gt;</span><br><span class="line">&lt;/beans&gt;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>使用方法：<code>c:_index[-ref] = &quot;&quot;</code> 或者 <code>c:属性名[-ref] = &quot;&quot;</code></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;birthdayBean&quot;</span> <span class="attr">class</span>=<span class="string">&quot;java.util.Date&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;userBean&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.eunoiay.spring6.popj.User&quot;</span> </span></span><br><span class="line"><span class="tag">      <span class="attr">c:_0</span>=<span class="string">&quot;Eunoiay&quot;</span> <span class="attr">c:age</span>=<span class="string">&quot;18&quot;</span> <span class="attr">c:birthday-ref</span>=<span class="string">&quot;birthdayBean&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<h4 id="util-命名空间-实现集合复用">util 命名空间 - 实现集合复用</h4>
<p>使用 util 命名空间可以实现集合类型的 <strong>配置复用</strong></p>
<ol>
<li>
<p>引入 util 命名空间，添加 <code>xmlns:util</code> 和 <code>xsd</code></p>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;</span><br><span class="line">       xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><br><span class="line"><span class="addition">+	   xmlns:util=&quot;http://www.springframework.org/schema/util&quot;</span></span><br><span class="line">       xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans 														   http://www.springframework.org/schema/beans/spring-beans.xsd</span><br><span class="line"><span class="addition">+      					   http://www.springframework.org/schema/util 														   http://www.springframework.org/schema/util/spring-beans.xsd&quot;&gt;</span></span><br><span class="line">&lt;/beans&gt;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>使用方法：通过 <code>&lt;util:properties&gt;</code>，<code>&lt;util:list&gt;</code>，<code>&lt;util:map&gt;</code> 等标签声明 util 命名空间内可复用的配置</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">util:propertis</span> <span class="attr">id</span>=<span class="string">&quot;dbProperty&quot;</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">&quot;driver&quot;</span>&gt;</span>com.mysql.cj.jdbc.Driver<span class="tag">&lt;/<span class="name">prop</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">&quot;url&quot;</span>&gt;</span>jdbc:mysql://localhost:3306/spring6<span class="tag">&lt;/<span class="name">prop</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">&quot;username&quot;</span>&gt;</span>root<span class="tag">&lt;/<span class="name">prop</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">&quot;password&quot;</span>&gt;</span>123<span class="tag">&lt;/<span class="name">prop</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">util:propertis</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>通过 <code>ref</code> 属性，引用 util 命名空间的集合</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- DataSource --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.eunoiay.spring6.jdbc.MyDataSource&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- ref 属性引入 util 中的信息 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;properties&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;dbProperty&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<h4 id="context-命名空间-引入外部文件">context 命名空间 - 引入外部文件</h4>
<p>通过 <code>context 命名空间</code> 可以引入外部的属性文件 ( .properties 文件) 中的配置信息。</p>
<p>例如，引入配置 Druid 连接池时的配置文件 <code>druid.properties</code></p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">dirverClass</span>=<span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line"><span class="attr">url</span>=<span class="string">jdbc:mysql://localhost:3306/spring6_learning</span></span><br><span class="line"><span class="attr">username</span>=<span class="string">root</span></span><br><span class="line"><span class="attr">password</span>=<span class="string">123</span></span><br></pre></td></tr></table></figure>
<p>使用方法如下，</p>
<ol>
<li>
<p>引入 <code>context</code> 命名空间，<code>xmlns:context</code> 与 <code>.xsd</code></p>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;</span><br><span class="line">       xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><br><span class="line"><span class="addition">+	   xmlns:context=&quot;http://www.springframework.org/schema/context&quot;</span></span><br><span class="line">       xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans                 										   http://www.springframework.org/schema/beans/spring-beans.xsd</span><br><span class="line"><span class="addition">+      					   http://www.springframework.org/schema/context 													   http://www.springframework.org/schema/context/spring-beans.xsd&quot;&gt;</span></span><br><span class="line">&lt;/beans&gt;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>使用 <code>&lt;context:property-placeecholder&gt;</code> 标签引入外部的属性配置文件</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- location 属性指定配置文件的路径，默认从类的根路径开始寻找资源 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">context:property-placeholder</span> <span class="attr">location</span>=<span class="string">&quot;druid.properties&quot;</span> <span class="attr">file-encoding</span>=<span class="string">&quot;utf-8&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>根据引入的 <code>druid.properties</code> 文件中的 <code>key</code>，在 XML 文件中通过 <code>$&#123;key&#125;</code> 的形式来取它对应的值</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.eunoiay.spring6.jdbc.MyDruid&quot;</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driver&quot;</span> <span class="attr">value</span>=<span class="string">$&#123;driverClass&#125;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">$&#123;url&#125;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- $ 默认先加载 Windows 系统的环境变量，有名为 username=Administrator 的环境变量 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 这里会导致加载的值不正确，建议不要这样命名 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">$&#123;username&#125;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">$&#123;password&#125;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>为了避免与 Windows 系统的环境变量冲突，<code>druid.propertise</code> 的键值对命名方式为，一般增加前缀 <code>jdbc.</code></p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">jdgc.dirverClass</span>=<span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line"><span class="attr">jdgc.url</span>=<span class="string">jdbc:mysql://localhost:3306/spring6</span></span><br><span class="line"><span class="attr">jdgc.username</span>=<span class="string">root</span></span><br><span class="line"><span class="attr">jdgc.password</span>=<span class="string">123</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="Bean-的作用域">Bean 的作用域</h3>
<p>在使用 <code>&lt;bean&gt;</code> 标签声明 bean 时，可以配置 <code>scope</code> 属性来设置 bean 对象的作用域，spring 提供了多种可选值：</p>
<ol>
<li>singleton：单例，IoC 容器初始化时，完成对象的创建，在容器关闭时销毁</li>
<li>prototype：原型，调用 getBean() 方法时创建对象，并且将该对象的控制权交给应用程序</li>
<li>request：请求，一个请求对应一个 Bean</li>
<li>session：会话，个会话对应一个 Bean</li>
<li>global session：<strong>Portlet 专用</strong>（在 Servlet 中使用时，同 session）</li>
<li>application：应用，一个应用对应一个 Bean</li>
<li>websocket：一个 WebSocket 生命周期对应一个 Bean</li>
<li>自定义 scope：实现 <code>Scope</code> 接口的类，通过 <code>CustomScopeConfigurer</code> 注册到 Spring 容器中</li>
</ol>
<blockquote>
<p>Bean 的作用域与 Bean 的生命周期中的创建与销毁相关，详情请阅读 <a href="">Bean 的生命周期</a></p>
</blockquote>
<h4 id="singleton">singleton</h4>
<p>默认情况下，Spring 的 IoC 容器声明的 Bean 是单例的，会在在初始化 <code>ApplicationContext</code> 对象时实例化，在容器关闭时销毁</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 默认：scope=&quot;singleton&quot; --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;user&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.eunoiay.pojo.User&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 初始化 ApplicationContext 对象时，实例化 scop=&quot;singleton&quot; 的 Bean</span></span><br><span class="line"><span class="type">ApplicationContext</span> <span class="variable">app</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;beans.xml&quot;</span>);</span><br></pre></td></tr></table></figure>
<h4 id="prototype">prototype</h4>
<p><code>&lt;bean&gt;</code>  标签声明 <code>Bean</code> 时，修改属性 <code>scope=&quot;prototype&quot;</code>，在调用 <code>app.getBean()</code> 方法时完成 Bean 的实例化。此时 Bean 的实例就交给应用程序管理，Spring 容器将不再跟踪其生命周期。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;user&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.eunoiay.pojo.User&quot;</span> <span class="attr">scope</span>=<span class="string">&quot;prototype&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> app.getBean(<span class="string">&quot;user&quot;</span>, User.class);</span><br></pre></td></tr></table></figure>
<h4 id="自定义-scope">自定义 scope</h4>
<p>Spring 没有提供线程级别（在同一个线程中，获取的 Bean 都是同一个。跨线程则是不同的对象）的 scope 可选值，但允许用户自定义 scope，实现 Scope 接口即可</p>
<ol>
<li>
<p>自定义 Scope，实现 Scope 接口（虽然没有提供 scope 的可选值，Spring 内置了 <code>SimpleThreadScope</code> 类供我们使用）</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SimpleThreadScope</span> <span class="keyword">implements</span> <span class="title class_">Scope</span> &#123;&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>注册自定义的 Scope 到 Spring 容器中</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">&lt;!-- Spring 通过 CustomScopeConfigurer 类管理自定义的 Scope --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.beans.factory.config.CustomScopeConfigurer&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 注入 Map 集合 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;scopes&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">map</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">&quot;thread&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.context.support.SimpleThreadScope&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">entry</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">map</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>注册后，就可以将注册时的 <code>key</code> 作为  <code>scope</code> 的值了</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;user&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.powernode.spring6.popj.User&quot;</span> <span class="attr">scope</span>=<span class="string">&quot;thread&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="Bean-的实例化方式">Bean 的实例化方式</h3>
<p>Spring 为 Bean提供了多种实例化方式（十分灵活）</p>
<ol>
<li>构造器</li>
<li>简单工厂模式</li>
<li>工厂方法模式</li>
<li>FactoryBean (Spring 提供的工厂方法模式接口)</li>
</ol>
<h4 id="构造器">构造器</h4>
<p>在此之前，我们在 <code>spring.xml</code> 文件中声明 bean 的方式，都是使用构造方法来实例化 bean 的</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;user&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.eunoiay.spring6.pojo.User&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="简单工厂">简单工厂</h4>
<p><code>&lt;bean&gt;</code> 标签中的 <code>class</code> 属性来指定工厂类，<code>factory-method</code> 属性来配置工厂的静态方法</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;apple&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.eunoiay.spring6.factory.FruitFactory&quot;</span> <span class="attr">factory-method</span>=<span class="string">&quot;getByName&quot;</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 简单工厂相当于构造器，依然可以使用 &lt;constructor-arg&gt; 设置静态方法的参数 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">index</span>=<span class="string">&quot;0&quot;</span> <span class="attr">name</span>=<span class="string">&quot;fruiteName&quot;</span> <span class="attr">type</span>=<span class="string">&quot;java.lang.String&quot;</span> <span class="attr">value</span>=<span class="string">&quot;apple&quot;</span>/&gt;</span> </span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- &lt;property&gt; 仍然可以通过 setter 给 bean 对象属性赋值 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;color&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;red&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="工厂方法">工厂方法</h4>
<p>通过 <code>&lt;bean&gt;</code> 声明/定义一个工厂对象后，通过 <code>factory-bean</code> 属性引用声明的工厂对象，<code>factory-method</code> 配置调用的工厂方法</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;appleFactory&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.eunoiay.spring6.factory.AppleFactory&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;apple&quot;</span> <span class="attr">factory-bean</span>=<span class="string">&quot;appleFactory&quot;</span> <span class="attr">factory-method</span>=<span class="string">&quot;createByColor&quot;</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">value</span>=<span class="string">&quot;red&quot;</span>/&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h5 id="FactoryBean">FactoryBean</h5>
<p>通过工厂方法实例化 Bean 时，需要我们在外部声明 <code>factory-bean</code>，且需要配置 <code>factory-method</code>，没有统一的接口</p>
<p>Spring 提供了  FactoryBean 接口，来规范我们设计的工厂</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AppleFactory</span> <span class="keyword">implements</span> <span class="title class_">FactoryBean</span>&lt;Apple&gt; &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Apple <span class="title function_">getObject</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Person</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Class&lt;?&gt; getObjectType() &#123;</span><br><span class="line">        <span class="keyword">return</span> Apple.class;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// isSingleton() 有默认实现，默认返回 true</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isSingleton</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// false 表示原型 prototype</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在 <code>spring.xml</code> 只需配置 <code>class</code> 属性</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;apple&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.eunoiay.spring6.factory.AppleFactory&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>注意区分 FacotryBean 和 BeanFactor</p>
</blockquote>
<h5 id="区分-FactoryBean-和-BeanFactory">区分 FactoryBean 和 BeanFactory</h5>
<ol>
<li>
<p>FactoryBean 是规范我们工厂方法模式的接口，整合第三方框架时，都要通过 FactoryBean 来实现，是特殊的 bean（工厂 bean）</p>
<p>Spring 中，bean 可以分为两类：</p>
<ul>
<li>普通 bean</li>
<li>工厂 bean，可以辅助 Spring 实例化其它 Bean 对象</li>
</ul>
</li>
<li>
<p>BeanFactory 是 Spring IoC 容器的顶级对象，用于创建 bean，是工厂</p>
</li>
</ol>
<h5 id="通过-FactoryBean-实现自定义-Date">通过 FactoryBean 实现自定义 Date</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DateFactory</span> <span class="keyword">implements</span> <span class="title class_">FactoryBean</span>&lt;java.util.Date&gt; &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Date <span class="title function_">getObject</span><span class="params">(String date)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">SimpleDateFormat</span> <span class="variable">sdf</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleDateFormat</span>(<span class="string">&quot;yyyy-MM-dd&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> sdf.parse(date);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Class&lt;?&gt; getObjectType() &#123;</span><br><span class="line">        <span class="keyword">return</span> java.util.Date.class;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;birthday&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.powernode.spring6.bean.DateFactoryBean&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">value</span>=<span class="string">&quot;2003-01-01&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="Bean-的生命周期">Bean 的生命周期</h3>
<p>所谓的生命周期就是：一个Bean对象从它的创建、初始化到销毁的整个过程。下面提出两个学习 spring 时未知的问题，</p>
<ul>
<li>什么时候创建/销毁 Bean 对象？</li>
<li>创建/销毁 Bean 对象的前后会调用什么方法？</li>
</ul>
<p>理解 Spring Bean 的生命周期可以帮助开发者更好地管理 Bean，可以实现以下需求：</p>
<ol>
<li>避免重复初始化 Bean，提高 Bean 实例化的效率</li>
<li>在 Bean 初始化前后做些额外的处理，如日志记录、权限检查等</li>
<li>实现自定义的操作，如在 Bean 销毁时释放资源、设置缓存等</li>
<li>理解 Bean 的整个生命周期有助于排查问题，提高应用程序的可维护性</li>
<li>解Spring AOP 等功能的实现原理，并参与定制过程</li>
</ol>
<p>其实生命周期的本质是：在哪个时间节点上调用了哪个类的哪个方法。</p>
<h4 id="初级（五步）">初级（五步）</h4>
<p>Bean 生命周期可以粗略的划分为五大步：</p>
<ol>
<li>实例化 Bean（构造器、简单工厂、工厂方法）</li>
<li>依赖注入（调用 setter 给对象的属性赋值）</li>
<li>初始化 Bean（调用 Bean 的初始化方法，需要在 XML 文件中配置 <code>&lt;bean&gt;</code> 的 <code>init-method</code> 属性）</li>
<li>使用 Bean（应用程序使用）</li>
<li>销毁 Bean（调用 Bean 的销毁方法，需要在 XML 文件中配置 <code>&lt;bean&gt;</code> 的 <code>destory-method</code> 属性）</li>
</ol>
<p>![image-20240827224647597](D:\Program Files (x86)\Typora\image\image-20240827224647597.png)</p>
<p>我们可以通过下面的代码，来测试这五步的执行顺序</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> age;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">User</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;第一步：实例化 constructor&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setAge</span><span class="params">(<span class="type">int</span> age)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;第二步：依赖注入 setter&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;第三步：初始化 init()&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">destroy</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;第五步：销毁 destroy()&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">ApplicationContext</span> <span class="variable">app</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;beans.xml&quot;</span>);</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> app.getBean(<span class="string">&quot;user&quot;</span>, User.class);</span><br><span class="line">        System.out.println(<span class="string">&quot;第四步：使用 Bean (应用程序使用...)&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 在程序结束前，关闭 IoC 容器</span></span><br><span class="line">        ((ClassPathXmlApplicationContext)app).close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;user&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.eunoiay.spring6.pojo.User&quot;</span> <span class="attr">init-method</span>=<span class="string">&quot;init&quot;</span> <span class="attr">destroy-method</span>=<span class="string">&quot;destroy&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;age&quot;</span> <span class="attr">value</span>=<span class="string">&quot;18&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="中级-BeanPostProcessor（七步）">中级 BeanPostProcessor（七步）</h4>
<p>在 Spring 中，通过 <code>BeanPostProcessor</code> （Bean 后处理器）可以在初始化 Bean 的前后做些额外的处理，如日志记录、权限检查等。</p>
<p>![image-20240827230723465](D:\Program Files (x86)\Typora\image\image-20240827230723465.png)</p>
<p>使用方法：</p>
<ol>
<li>
<p>实现 <code>BeanPostProcessor</code> 接口，例如我们需要记录日志</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LogBeanPostProcessor</span> <span class="keyword">implements</span> <span class="title class_">BeanPostProcessor</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">postProcessBeforeInitialization</span><span class="params">(Object bean, String name)</span> <span class="keyword">throws</span> BeansException &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;before initialization...&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> bean;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">postProcessAfterInitialization</span><span class="params">(Object bean, String name)</span> <span class="keyword">throws</span> BeansException &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;after initialization...&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> bean;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>在 XML 文件中，声明 <strong>当前 XML 文件</strong> 的 Bean 后处理器（仅对当前的 .xml 文件中声明的 Bean 生效）</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;com.eunoiay.spring6.processor.LogBeanPostProcessor&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<h4 id="高级（十步）">高级（十步）</h4>
<p>Spring IoC 容器会检查 Bean 是否实现了某些接口，以扩展 Bean 的生命周期</p>
<ol>
<li>
<p>Aware 相关接口（BeanNameAware、BeanClassLoaderAware、BeanFactoryAware）<br>
**check 时间节点：**依赖注入之后，Bean 后处理器 before() 执行前</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> <span class="keyword">implements</span> <span class="title class_">BeanNameAware</span>, BeanClassLoaderAware, BeanFactoryAware &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setBeanClassLoader</span><span class="params">(ClassLoader classLoader)</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setBeanFactory</span><span class="params">(BeanFactory beanFactory)</span> <span class="keyword">throws</span> BeansException &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setBeanName</span><span class="params">(String name)</span> &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>InitializingBean 接口<br>
**check 时间节点：**Bean 后处理器 after() 执行之后，初始化之前</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> <span class="keyword">implements</span> <span class="title class_">InitializingBean</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterPropertiesSet</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>DisposableBean 接口<br>
**check 时间节点：**使用 Bean 之后，销毁 Bean 之前</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> <span class="keyword">implements</span> <span class="title class_">DisposableBean</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">destroy</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>![image-20240827234038415](D:\Program Files (x86)\Typora\image\image-20240827234038415.png)</p>
<h4 id="Bean-的作用域细节">Bean 的作用域细节</h4>
<p>Spring IoC 容器只对 singleton 作用域的 Bean 进行完整的生命周期管理</p>
<p>对于 prototype 作用域的 Bean，Spring IoC 容器不负责最后两步 DisposableBean 接口的检查，以及 destory-method 的调用</p>
<h4 id="DefaultListBeanFactory">DefaultListBeanFactory</h4>
<p>Spring 提供了 <code>DefaultListBeanFactory</code>，以允许应用程序（我们）通过 new 关键字创建的对象，注册进入 Spring IoC 容器管理</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建 DefaultListableBeanFactory 对象</span></span><br><span class="line"><span class="type">DefaultListableBeanFactory</span> <span class="variable">factory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DefaultListableBeanFactory</span>();</span><br><span class="line"><span class="comment">// 注册 Bean</span></span><br><span class="line">factory.registerSingleton(<span class="string">&quot;user&quot;</span>, user);</span><br></pre></td></tr></table></figure>
<h3 id="Bean-的循环依赖问题">Bean 的循环依赖问题</h3>
<p>**循环依赖：**A 对象中有 B 属性，B 对象中有 A 属性（你中有我，我中有你）</p>
<p>例如：丈夫类 Husband，妻子类 Wife。Husband 中有 Wife 的引用，Wife 中有 Husband 的引用。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Husband</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Wife wife;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Wife</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Husband husband;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Spring IoC 容器 <strong>唯一</strong> 可以解决的循环依赖情况：bean 的作用域为 singleton  且循环依赖通过 setter 注入</p>
<p>解决方案（单例缓存机制）如下：</p>
<ol>
<li>作用域为 singelton 的 Bean，实例化与依赖注入是完全分离开的，Bean 实例化后会直接加入缓存，提前曝光</li>
<li>所有 singleton 作用域的 Bean 实例化之后，才会再进行依赖注入</li>
</ol>
<p><strong>循环依赖产生的异常：</strong><code>BeanCurrentlyInCreationException</code></p>
<p>**细节：**节点数为 2 的循环依赖中，其中之一作用域为 singleton 即可，依赖于 Spring IoC 容器的提前曝光机制</p>
<blockquote>
<p>理解了曝光机制，就清楚 Spring IoC 容器什么时候会产生循环依赖的问题</p>
</blockquote>
<h4 id="源码分析-–-三级缓存">源码分析 – 三级缓存</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Object</span> <span class="variable">bean</span> <span class="operator">=</span> instanceWrapper.getWrappedInstance();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 提前曝光工厂</span></span><br><span class="line"><span class="built_in">this</span>.addSingletonFactory(beanName, () -&gt; &#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="built_in">this</span>.getEarlyBeanReference(beanName, mbd, bean);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>进入 <code>getEarlyBeanReference</code> 方法后，DefaultSingletonBeanRegistry</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 一级缓存：完整的 Bean 单例</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> Map&lt;String, Object&gt; singletonObjects = <span class="keyword">new</span> <span class="title class_">ConcurrentHashMap</span>(<span class="number">256</span>);</span><br><span class="line"><span class="comment">// 二级缓存：早期的 Bean 单例，没有调用 setter 注入依赖</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> Map&lt;String, Object&gt; earlySingletonObjects = <span class="keyword">new</span> <span class="title class_">ConcurrentHashMap</span>(<span class="number">16</span>);</span><br><span class="line"><span class="comment">// 三级缓存：单例工厂对象，每一个单例 Bean 都会对应一个单例 FactoryBean 对象</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> Map&lt;String, ObjectFactory&lt;?&gt;&gt; singletonFactories = <span class="keyword">new</span> <span class="title class_">HashMap</span>(<span class="number">16</span>);</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">addSingletonFactory</span><span class="params">(String beanName, ObjectFactory&lt;?&gt; singletonFactory)</span> &#123;</span><br><span class="line">    Assert.notNull(singletonFactory, <span class="string">&quot;Singleton factory must not be null&quot;</span>);</span><br><span class="line">    <span class="keyword">synchronized</span>(<span class="built_in">this</span>.singletonObjects) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="built_in">this</span>.singletonObjects.containsKey(beanName)) &#123;</span><br><span class="line">            <span class="built_in">this</span>.singletonFactories.put(beanName, singletonFactory);</span><br><span class="line">            <span class="built_in">this</span>.earlySingletonObjects.remove(beanName);</span><br><span class="line">            <span class="built_in">this</span>.registeredSingletons.add(beanName);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>再读一读 <code>getSingleton()</code> 方法，是如何从缓存中取出对象的。</p>
<h2 id="Spring-注解式开发">Spring 注解式开发</h2>
<h3 id="组件扫描">组件扫描</h3>
<p>在 XML 文件中引入 context 命名空间，配置 <code>&lt;context:component-scan&gt;</code> 标签，Spring 容器会扫描配置包下的 <strong>注解</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 添加组件扫描 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.eunoiay.spring6.pojo&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>
<p>base-package 属性可以指定多个包，分隔符为 <code>,</code></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.eunoiay.spring6.pojo, com.eunoiay.spring6.dao&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="声明-Bean">声明 Bean</h3>
<h4 id="Component">@Component</h4>
<p>Spring 提供了四个注解，与 XML 配置文件中的 <code>&lt;bean&gt;</code> 标签行为相同</p>
<ol>
<li>@Component</li>
<li>@Controller（标注 controller）</li>
<li>@Service（标注 service）</li>
<li>@Repository（标注 dao）</li>
</ol>
<p>核心注解是 @Component，其余三个注解都是它的别名（增强程序的可读性），@Component 注解源码如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Target(&#123;ElementType.TYPE&#125;)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="meta">@Indexed</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Component &#123;</span><br><span class="line">    <span class="comment">// 相当于 &lt;bean&gt; 标签的 id 属性</span></span><br><span class="line">    String <span class="title function_">value</span><span class="params">()</span> <span class="keyword">default</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Target(&#123;ElementType.TYPE&#125;)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Service &#123;</span><br><span class="line">    <span class="comment">// @Component 的别名</span></span><br><span class="line">    <span class="meta">@AliasFor(</span></span><br><span class="line"><span class="meta">        annotation = Component.class</span></span><br><span class="line"><span class="meta">    )</span></span><br><span class="line">    String <span class="title function_">value</span><span class="params">()</span> <span class="keyword">default</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="使用方法">使用方法</h4>
<ol>
<li>
<p>添加 spring-aop 的依赖（引入 spring-context 依赖即可）</p>
</li>
<li>
<p>在配置文件中添加 context 命名空间</p>
</li>
<li>
<p>添加组件扫描：在 XML 配置文件中指定 Spring 容器需要扫描的 <strong>包/类</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 添加组件扫描 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.eunoiay.spring6.pojo&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>给 Class 标注 @Component 注解后，在配置文件中添加组件扫描，即可省略 <code>&lt;bean&gt;</code> 标签的配置</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component(&quot;user&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>@Component 相关注解的属性 <code>value = &quot;&quot;</code> 时，Bean 的 id 默认为：<strong>类名首字母小写</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span>  <span class="comment">// id = &quot;userService&quot;</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserService</span> &#123;&#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h4 id="选择性实例化-Bean">选择性实例化 Bean</h4>
<p>**需求：**在 dao 包下，只允许 @Repository 标注的类纳入 IoC 容器管理</p>
<p>**解决：**可以配置 <code>&lt;context:component-scan&gt;</code> 标签的属性 <code>use-default-filters=&quot;false&quot;</code>，然后通过 <code>&lt;context:include-filter&gt;</code> 子标签包含需要经过 filter 的注解，也可以使用 <code>&lt;context:exclude-filter&gt;</code> 子标签进行排除处理</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.eunoiay.spring6.dao&quot;</span> <span class="attr">use-default-filters</span>=<span class="string">&quot;false&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- include --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:include-filter</span> <span class="attr">type</span>=<span class="string">&quot;annotation&quot;</span> <span class="attr">expression</span>=<span class="string">&quot;org.springframework.stereotype.Repository&quot;</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- exclude --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:exclude-filter</span> <span class="attr">type</span>=<span class="string">&quot;annotation&quot;</span> <span class="attr">expression</span>=<span class="string">&quot;org.springframework.stereotype.Controller&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="依赖注入-2">依赖注入</h3>
<p>Spring 提供了 4 个负责依赖注入的注解：</p>
<ol>
<li>@Value</li>
<li>@AutoWired</li>
<li>@Qualifier</li>
<li>@Resource</li>
</ol>
<h4 id="简单类型值">简单类型值</h4>
<h5 id="Value">@Value</h5>
<p>@Value 用于注入简单类型值，注解源码如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Target(&#123;ElementType.FIELD, ElementType.METHOD, ElementType.PARAMETER, ElementType.ANNOTATION_TYPE&#125;)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Value &#123;</span><br><span class="line">    String <span class="title function_">value</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="使用方法-2">使用方法</h5>
<ol>
<li>
<p>标注 Field（可以不提供 setter）</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="meta">@Value(&quot;root&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>标注 Method（setter）</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Value(&quot;root&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setUsername</span><span class="params">(String username)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.username = username;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>标注 Parameter</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">User</span><span class="params">(<span class="meta">@Value(&quot;root&quot;)</span> String username, <span class="meta">@Value(&quot;root&quot;)</span> String password)</span> &#123;</span><br><span class="line">    	<span class="built_in">this</span>.username = username;</span><br><span class="line">        <span class="built_in">this</span>.password = password;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h4 id="非简单类型值">非简单类型值</h4>
<p>通过 @AutoWired 和 @Qualifier，可以实现非简单类型值的自动装配</p>
<h5 id="AutoWired">@AutoWired</h5>
<p>@AutoWired 默认是通过 <code>byType</code> 的方式注入，源码如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Target(&#123;ElementType.CONSTRUCTOR, ElementType.METHOD, ElementType.PARAMETER, ElementType.FIELD, ElementType.ANNOTATION_TYPE&#125;)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Autowired &#123;</span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">required</span><span class="params">()</span> <span class="keyword">default</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>使用时，直接用 @AutoWired 注解标注时，默认以 <code>byType</code> 方式完成自动装配（IoC 容器中不能存在两个类型相同的 Bean 对象）</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserSeriveImpl</span> <span class="keyword">implements</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    <span class="meta">@AutoWired</span></span><br><span class="line">    <span class="keyword">private</span> Userdao dao;  <span class="comment">// 同 @Value，@AutoWired 标注 Field 时可以不提供 setter</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// @AutoWired 会根据类型，查找到 UserDao 对象进行自动装配</span></span><br><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserDaoImpl</span> <span class="keyword">implements</span> <span class="title class_">UserDao</span> &#123;&#125;</span><br></pre></td></tr></table></figure>
<h5 id="Qualifier">@Qualifier</h5>
<p>通过 @Qualifier 标签，可以使 @AutoWired 以 <code>byName</code> 的方式完成自动装配，@Qualifier 源码如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Target(&#123;ElementType.FIELD, ElementType.METHOD, ElementType.PARAMETER, ElementType.TYPE, ElementType.ANNOTATION_TYPE&#125;)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Inherited</span></span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Qualifier &#123;</span><br><span class="line">    String <span class="title function_">value</span><span class="params">()</span> <span class="keyword">default</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>使用时，在@AutoWired 标注的目标，添加 @Qualifier 注解指定注入 bean 对象的 id</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserSeriveImpl</span> <span class="keyword">implements</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    <span class="meta">@AutoWired</span></span><br><span class="line">    <span class="meta">@Qualifier(&quot;userDaoImplForMysql&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Userdao dao;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="Resource（推荐）">@Resource（推荐）</h5>
<p>@Resource 注解是 JDK 扩展包中的，是 JSR-250 标准（JSR 是 Java规范提案）中制定的注解类型，属于 JDK 的一部分，更加具有通用性，也是官方推荐使用的非简单类型值注入的注解</p>
<p>@Resource 提供了更丰富的属性，其源码如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Target(&#123;ElementType.TYPE, ElementType.FIELD, ElementType.METHOD&#125;)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Repeatable(Resources.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Resource &#123;</span><br><span class="line">    String <span class="title function_">name</span><span class="params">()</span> <span class="keyword">default</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line">    String <span class="title function_">lookup</span><span class="params">()</span> <span class="keyword">default</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line">    Class&lt;?&gt; type() <span class="keyword">default</span> Object.class;</span><br><span class="line"></span><br><span class="line">    AuthenticationType <span class="title function_">authenticationType</span><span class="params">()</span> <span class="keyword">default</span> Resource.AuthenticationType.CONTAINER;</span><br><span class="line"></span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">shareable</span><span class="params">()</span> <span class="keyword">default</span> <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">    String <span class="title function_">mappedName</span><span class="params">()</span> <span class="keyword">default</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line">    String <span class="title function_">description</span><span class="params">()</span> <span class="keyword">default</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">enum</span> <span class="title class_">AuthenticationType</span> &#123;</span><br><span class="line">        CONTAINER,</span><br><span class="line">        APPLICATION;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="title function_">AuthenticationType</span><span class="params">()</span> &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们需要知道 @Resource 注解的几个细节：</p>
<ol>
<li>@Resource 可以标注 Filed、Type、Setter</li>
<li>@Resource 属性默认以 <code>byName</code> 的方式完成自动装配，若 <code>name=&quot;&quot;</code>，将设置 <code>name=属性名/setter 去掉 set 首字母小写</code><br>
若无法找到，则通过 <code>byType</code> 的方式查找</li>
</ol>
<p><strong>使用方法</strong></p>
<ol>
<li>
<p>引入扩展 JDK 扩展包</p>
<ul>
<li>
<p>Spring6 不再支持 JavaEE，而是支持 JakartaEE9<br>
Oracle 将 JavaEE 贡献给 Apache 后，Apache 改名为 JakartaEE，javax.* 包名统一修改为 jakata.* 了</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- Spring6 引入 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>jakarta.annotation<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jakarta.annotation-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.1.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>Spring5 引入的扩展包</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.annotation<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>javax.annotation-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.3.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li>
<p>标注 @Resource</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserSeriveImpl</span> <span class="keyword">implements</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    <span class="meta">@Resource(name = )</span></span><br><span class="line">    <span class="keyword">private</span> Userdao dao;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h4 id="细节小结">细节小结</h4>
<ol>
<li>
<p>@Value 和 @AutoWired 标注 Field 时可以不提供 setter</p>
</li>
<li>
<p>若 constructor 唯一，且与 field 相匹配，那么不使用 @AutoWired 标注，也可以完成注入</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserSeriveImpl</span> <span class="keyword">implements</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Userdao dao;</span><br><span class="line">    <span class="comment">// 这种情况下，可以省略 @AutoWired </span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">UserSeriveImpl</span><span class="params">(Userdao dao)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.dao = dao;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>@Autowired 注解设置属性 <code>required = false</code> 时，表示能装就装，装不上就不装。实际开发中基本都是必须装配成功的</p>
</li>
<li>
<p>@Resource 属性默认以 <code>byName</code> 的方式完成自动装配，若 <code>name=&quot;&quot;</code>，将设置 <code>name=属性名/setter 去掉 set 首字母小写</code><br>
若无法找到，则通过 <code>byType</code> 的方式查找</p>
</li>
</ol>
<h3 id="Java-配置类-全注解开发">Java 配置类 - 全注解开发</h3>
<p>在前面的学习中，仍需使用 XML 文件开启组件扫描，Spring 提供注解 @Configuration 标注 Java 类为配置类来代替 XML 文件</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringConfig</span> &#123;&#125;</span><br></pre></td></tr></table></figure>
<p>此时，没有 XML 文件，而是通过配置类，全注解式开发，就要使用 <code>AnnotationConfigApplicationContext</code> 作为 IoC 容器</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ApplicationContext</span> <span class="variable">app</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AnnotationConfigApplicationContext</span>(SpringConfig.class);</span><br></pre></td></tr></table></figure>
<h4 id="context-命名空间相关">context 命名空间相关</h4>
<h5 id="ComponentScan">@ComponentScan</h5>
<p>通过 @ComponentScan 来开启组件扫描</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan(&#123;&quot;com.eunoiay.spring6.pojo&quot;, &quot;com.eunoiay.spring6.dao&quot;&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringConfig</span> &#123;&#125;</span><br></pre></td></tr></table></figure>
<h5 id="PropertySource">@PropertySource</h5>
<p>通过 @PropertySource 注解，可以引入外部 <code>.properties</code> 配置文件，代替 <code>&lt;context:property-placeholder&gt;</code> 标签</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PropertySource(&#123;&quot;classpath:druid.properties&quot;&#125;)</span></span><br></pre></td></tr></table></figure>
<h4 id="bean-标签相关">&lt;bean&gt; 标签相关</h4>
<h5 id="Bean">@Bean</h5>
<p>DruidDataSource 来自第三方，无法使用 @Component 注解，那么如何像在 XML 文件中使用 <code>&lt;bean&gt;</code> 一样声明/定义 Bean 呢？</p>
<p>Spring 提供了 @Bean 注解，允许我们在 Java 配置类中，声明 Bean 对象纳入 IoC 容器管理，其源码如下，</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Target(&#123;ElementType.METHOD, ElementType.ANNOTATION_TYPE&#125;)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Bean &#123;</span><br><span class="line">    <span class="meta">@AliasFor(&quot;name&quot;)</span></span><br><span class="line">    String[] value() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line">	<span class="comment">// id</span></span><br><span class="line">    <span class="meta">@AliasFor(&quot;value&quot;)</span></span><br><span class="line">    String[] name() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line">	</span><br><span class="line">    <span class="comment">// autowire</span></span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">autowireCandidate</span><span class="params">()</span> <span class="keyword">default</span> <span class="literal">true</span>;</span><br><span class="line">	</span><br><span class="line">    <span class="comment">// init-method 与 destroy-method</span></span><br><span class="line">    String <span class="title function_">initMethod</span><span class="params">()</span> <span class="keyword">default</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">    String <span class="title function_">destroyMethod</span><span class="params">()</span> <span class="keyword">default</span> <span class="string">&quot;(inferred)&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们可以使用 @Bean 标注方法，引用来自外部文件的内容来创建 DruidDataSource 对象，<code>name=&quot;&quot;</code> 时，<code>name=方法名</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan(&#123;&quot;com.eunoiay.spring6.pojo&quot;, &quot;com.eunoiay.spring6.dao&quot;&#125;)</span></span><br><span class="line"><span class="meta">@PropertySource(&#123;&quot;classpath:druid.properties&quot;&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringConfig</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> DataSource <span class="title function_">createDataSource</span><span class="params">(<span class="meta">@Value(&quot;$&#123;jdbc.user&#125;&quot;)</span> String username,</span></span><br><span class="line"><span class="params">                                       <span class="meta">@Value(&quot;$&#123;jdbc.password&#125;&quot;)</span> String password,</span></span><br><span class="line"><span class="params">                                       <span class="meta">@Value(&quot;$&#123;jdbc.url&#125;&quot;)</span> String url,</span></span><br><span class="line"><span class="params">                                       <span class="meta">@Value(&quot;$&#123;jdbc.driver&#125;&quot;)</span> String driverClassName)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">DruidDataSource</span> <span class="variable">dataSource</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DruidDataSource</span>();</span><br><span class="line">        dataSource.setUsername(username);</span><br><span class="line">        dataSource.setPassword(password);</span><br><span class="line">        dataSource.setUrl(url);</span><br><span class="line">        dataSource.setDriverClassName(driverClassName);</span><br><span class="line">        <span class="keyword">return</span> dataSource;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="Scope">@Scope</h5>
<p>可以使用 @Scope 指定使用 @Bean 注解声明的 bean 的作用域</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="meta">@Scope(&quot;prototype&quot;)</span></span><br><span class="line"><span class="keyword">public</span> UserDao <span class="title function_">userDao</span><span class="params">()</span> &#123;&#125;</span><br></pre></td></tr></table></figure>
<h4 id="Import">@Import</h4>
<p>@Import 注解允许从另一个配置类加载 @Bean 定义</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@Import(BeansConfig.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringConfig</span> &#123;&#125;</span><br></pre></td></tr></table></figure>
<h4 id="条件注册-bean">条件注册 bean</h4>
<h5 id="Conditional">@Conditional</h5>
<p>@Conditional 是 Spring4 新提供的注解，能够根据一定的条件进行判断，满足后才将 bean 纳入 IoC 容器管理，源码如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Target(&#123;ElementType.TYPE, ElementType.METHOD&#125;)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Conditional &#123;</span><br><span class="line">    Class&lt;? <span class="keyword">extends</span> <span class="title class_">Condition</span>&gt;[] value();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>从代码中可以看到，我们需要传入一个实现了  Condition 函数式接口的 Class 数组</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@FunctionalInterface</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Condition</span> &#123;</span><br><span class="line">     <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> context:  判断条件能使用的上下文环境</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> metadata: 注解所在位置的注解信息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">matches</span><span class="params">(ConditionContext context, AnnotatedTypeMetadata metadata)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>若所有函数式接口的返回值都为 true，则将 bean 纳入 IoC 容器管理</p>
<p>通过 ConditionContext 对象可以获取的信息</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. 获取 IoC 容器 使用的  beanFactory</span></span><br><span class="line"><span class="type">ConfigurableListableBeanFactory</span> <span class="variable">factory</span> <span class="operator">=</span> context.getBeanFactory();</span><br><span class="line"><span class="comment">// 2. 获取类加载器</span></span><br><span class="line"><span class="type">ClassLoader</span> <span class="variable">loader</span> <span class="operator">=</span> context.getClassLoader();</span><br><span class="line"><span class="comment">// 3. 获取当前环境信息</span></span><br><span class="line"><span class="type">Environment</span> <span class="variable">environment</span> <span class="operator">=</span> context.getEnvironment();</span><br><span class="line"><span class="comment">// 4. 获取 bean 定义的注册类</span></span><br><span class="line"><span class="type">BeanDefinitionRegistry</span> <span class="variable">registry</span> <span class="operator">=</span> context.getRegistry();</span><br></pre></td></tr></table></figure>
<h5 id="应用场景">应用场景</h5>
<p>**需求：**根据当前操作系统来注入 User 实例（windows 系统下注入 bill，linux 系统 下注入 linus）</p>
<ol>
<li>
<p>实现 WindowsCondition 与 LinuxCondition</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WindowsCondition</span> <span class="keyword">implements</span> <span class="title class_">Condition</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">matches</span><span class="params">(ConditionContext context, AnnotatedTypeMetadata metadata)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">osName</span> <span class="operator">=</span> context.getEnvironment().getProperty(<span class="string">&quot;os.name&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> osName.contains(<span class="string">&quot;Windows&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LinuxCondition</span> <span class="keyword">implements</span> <span class="title class_">Condition</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">matches</span><span class="params">(ConditionContext context, AnnotatedTypeMetadata metadata)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">osName</span> <span class="operator">=</span> context.getEnvironment().getProperty(<span class="string">&quot;os.name&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> osName.contains(<span class="string">&quot;Linux&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>在 @Bean 注解上添加 @Conditional 注解</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BeanConfig</span> &#123;</span><br><span class="line">    <span class="meta">@Conditional(WindowsCondition.class)</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">bill</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">&quot;Bill Gates&quot;</span>, <span class="number">62</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Conditional(&#123;LinuxCondition.class&#125;)</span></span><br><span class="line">    <span class="meta">@Bean(name = &quot;linus&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">linus</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">&quot;Linus&quot;</span>, <span class="number">50</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>在 Windows 系统下，测试 IoC 容器中是否包含 User 对象 “linus”</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConditionalTest</span> &#123;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">ApplicationContext</span> <span class="variable">app</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AnnotationConfigApplicationContext</span>(BeanConfig.class);</span><br><span class="line">        Map&lt;String, User&gt; map = app.getBeansOfType(User.class);</span><br><span class="line">        </span><br><span class="line">        System.out.println(<span class="string">&quot;当前系统为：&quot;</span> + app.getEnvironment().getProperty(<span class="string">&quot;os.name&quot;</span>));</span><br><span class="line">        System.out.println(map);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h2 id="Spring-中的设计模式">Spring 中的设计模式</h2>
<h3 id="GoF-设计模式介绍">GoF 设计模式介绍</h3>
<p>Gang of Four 四人组 (Erich Gamma、Richard Helm、Ralph Johnson 和 John Vlissides) 编写了《Design Patterns: Elements of Reusable Object-Oriented Software》一书，描述了 23 种设计模式，可分为三种类型：</p>
<ol>
<li>**创建型 (5种)：**解决对象创建问题
<ul>
<li>单例模式</li>
<li>工厂方法模式</li>
<li>抽象工厂模式</li>
<li>建造者模式</li>
<li>原型模式</li>
</ul>
</li>
<li>**结构型 (7种)：**一些类或对象组合在一起的经典结构
<ul>
<li>代理模式</li>
<li>装饰模式</li>
<li>适配器模式</li>
<li>组合模式</li>
<li>享元模式</li>
<li>外观模式</li>
<li>桥接模式</li>
</ul>
</li>
<li>**行为型 (11个)：**解决类或对象之间的交互问题。
<ul>
<li>策略模式</li>
<li>模版方法模式</li>
<li>责任链模式</li>
<li>观察者模式</li>
<li>迭代子模式</li>
<li>命令模式</li>
<li>备忘录模式</li>
<li>状态模式</li>
<li>访问者模式</li>
<li>中介者模式</li>
<li>解释器模式</li>
</ul>
</li>
</ol>
<p>除了 GoF 23 种设计模式之外，还有其它的设计模式，比如：JavaEE 的设计模式（DAO模式、MVC 模式等）。</p>
<h3 id="工厂模式">工厂模式</h3>
<p>工厂模式（Factory Pattern）属于创建型模式，它提供了一种创建对象的方式，使得创建对象的过程与使用对象的过程分离</p>
<h4 id="三种形式">三种形式</h4>
<ol>
<li>简单工厂模式  Simple Factory Pattern（静态工厂方法模式）</li>
<li>工厂方法模式  Factory Method Pattern</li>
<li>抽象工厂模式  Abstract Factory Pattern</li>
</ol>
<blockquote>
<p>其中，简单工厂模式不属于 GoF 23 种设计模式</p>
</blockquote>
<h4 id="简单工厂模式（静态工厂方法模式）">简单工厂模式（静态工厂方法模式）</h4>
<p>简单工厂模式中的角色：</p>
<ul>
<li>抽象产品（抽象基类/接口）</li>
<li>具体产品（实现类）</li>
<li>工厂（工厂类）</li>
</ul>
<p>**实现方式：**对于存在继承/实现关系的类，通过一个统一的 <strong>工厂类</strong> 来创建不同子类对象</p>
<p><strong>解决的问题</strong></p>
<ol>
<li>在使用简单工厂模式前，对象的创建（产品的生产）与使用（消费）是耦合在一起的，而简单工厂模式可以使二者分离（生产与消费分离，分工明确，各司其职）</li>
<li>用户向创建一个对象时，只要知道其名称即可，屏蔽产品的具体实现，只关心产品的接口。可以利用工厂模式，实现单例模式，不必每次调用构造器创建新的对象。</li>
<li>工厂方法具有自己的名字，对于一个有很多重载的构造器来说，需要开发者特别熟悉这个类，才能找到合适的构造器</li>
<li>参考 《Effective Java》可以了解更多优势</li>
</ol>
<p><strong>缺点</strong></p>
<ol>
<li>当需要扩展新的实现类（新的产品）时，需要修改工厂类 <code>Factory</code> 的代码，违背 OCP</li>
<li>工厂类责任重大，一旦出错，整个系统都有可能瘫痪，被戏称为 <strong>全能类/上帝类</strong>（不要把鸡蛋放到一个篮子里）</li>
</ol>
<h4 id="工厂方法模式">工厂方法模式</h4>
<p>工厂方法模式中的角色：</p>
<ul>
<li>抽象产品（抽象基类/接口）</li>
<li>具体产品（实现类）</li>
<li>抽象工厂（抽象工厂基类/接口）</li>
<li>具体工厂（实现工厂类）</li>
</ul>
<p>**实现方式：**在简单工厂模式的基础上，引入抽象工厂角色，一个具体工厂对应一个具体产品</p>
<p>**解决问题：**解决简单工厂模式中的 OCP 问题，扩展新产品时，只需添加两个类（具体产品和具体工厂）</p>
<p>**缺点：**每次扩展，都引入两个类，导致类爆炸，增加系统复杂度</p>
<h4 id="抽象工厂模式">抽象工厂模式</h4>
<h3 id="代理模式">代理模式</h3>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="http://example.com">Eunoiay</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="http://example.com/2024/08/28/spring6/">http://example.com/2024/08/28/spring6/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://example.com" target="_blank">Eunoiayの博客</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/ssm/">ssm</a><a class="post-meta__tags" href="/tags/spring/">spring</a></div><div class="post_share"><div class="social-share" data-image="/static/img/avatar.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i>赞助</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/static/img/wechat.png" target="_blank"><img class="post-qr-code-img" src="/static/img/wechat.png" alt="微信"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="/static/img/alipay.jpeg" target="_blank"><img class="post-qr-code-img" src="/static/img/alipay.jpeg" alt="支付宝"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-full"><a href="/2024/08/23/hello-world/" title="Hello World"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Hello World</div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">1.</span> <span class="toc-text">Spring6</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BC%95%E5%85%A5"><span class="toc-number">1.1.</span> <span class="toc-text">引入</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#OCP"><span class="toc-number">1.1.1.</span> <span class="toc-text">OCP</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#DIP"><span class="toc-number">1.1.2.</span> <span class="toc-text">DIP</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#IoC-%E5%92%8C-DI"><span class="toc-number">1.1.3.</span> <span class="toc-text">IoC 和 DI</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Spring6-%E5%85%AB%E5%A4%A7%E6%A8%A1%E5%9D%97"><span class="toc-number">1.1.4.</span> <span class="toc-text">Spring6 八大模块</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Spring-%E9%A1%B9%E7%9B%AE%E6%90%AD%E5%BB%BA"><span class="toc-number">1.1.5.</span> <span class="toc-text">Spring 项目搭建</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Spring-%E5%AF%B9-IoC-%E7%9A%84%E5%AE%9E%E7%8E%B0"><span class="toc-number">1.2.</span> <span class="toc-text">Spring 对 IoC 的实现</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Spring-IoC-%E5%AE%B9%E5%99%A8%E6%8E%A5%E5%8F%A3"><span class="toc-number">1.2.1.</span> <span class="toc-text">Spring IoC 容器接口</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%9A%E8%BF%87-Ioc-%E5%AE%B9%E5%99%A8%E5%88%9B%E5%BB%BA%E3%80%81%E9%94%80%E6%AF%81%E5%AF%B9%E8%B1%A1"><span class="toc-number">1.2.2.</span> <span class="toc-text">通过 Ioc 容器创建、销毁对象</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5"><span class="toc-number">1.2.3.</span> <span class="toc-text">依赖注入</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BC%95%E5%85%A5-2"><span class="toc-number">1.2.3.1.</span> <span class="toc-text">引入</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B3%A8%E5%85%A5%E7%AE%80%E5%8D%95%E7%B1%BB%E5%9E%8B%E5%80%BC"><span class="toc-number">1.2.3.2.</span> <span class="toc-text">注入简单类型值</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E7%AE%80%E5%8D%95%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.2.3.2.1.</span> <span class="toc-text">查看简单类型</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE-XML-%E6%96%87%E4%BB%B6"><span class="toc-number">1.2.3.2.2.</span> <span class="toc-text">配置 XML 文件</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%B3%A8%E5%85%A5%E7%A9%BA%E5%AD%97%E7%AC%A6%E4%B8%B2-%E2%80%9C%E2%80%9D"><span class="toc-number">1.2.3.2.3.</span> <span class="toc-text">注入空字符串 “”</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%B3%A8%E5%85%A5%E7%A9%BA%E5%80%BC-null"><span class="toc-number">1.2.3.2.4.</span> <span class="toc-text">注入空值 null</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%B3%A8%E5%85%A5-java-util-Date-%E7%AE%80%E5%8D%95%E7%B1%BB%E5%9E%8B%E5%80%BC"><span class="toc-number">1.2.3.2.5.</span> <span class="toc-text">注入 java.util.Date 简单类型值</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%80%BC%E4%B8%AD%E5%90%AB%E6%9C%89%E7%89%B9%E6%AE%8A%E7%AC%A6%E5%8F%B7"><span class="toc-number">1.2.3.2.6.</span> <span class="toc-text">值中含有特殊符号</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B3%A8%E5%85%A5%E9%9D%9E%E7%AE%80%E5%8D%95%E7%B1%BB%E5%9E%8B%E5%80%BC"><span class="toc-number">1.2.3.3.</span> <span class="toc-text">注入非简单类型值</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%A4%96%E9%83%A8-bean"><span class="toc-number">1.2.3.3.1.</span> <span class="toc-text">外部 bean</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%86%85%E9%83%A8-bean"><span class="toc-number">1.2.3.3.2.</span> <span class="toc-text">内部 bean</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%95%B0%E7%BB%84-%E9%9B%86%E5%90%88"><span class="toc-number">1.2.3.3.3.</span> <span class="toc-text">数组&#x2F;集合</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%B3%A8%E5%85%A5-Properties"><span class="toc-number">1.2.3.3.4.</span> <span class="toc-text">注入 Properties</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BA%A7%E8%81%94%E5%B1%9E%E6%80%A7"><span class="toc-number">1.2.3.4.</span> <span class="toc-text">级联属性</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%87%AA%E5%8A%A8%E8%A3%85%E9%85%8D"><span class="toc-number">1.2.3.5.</span> <span class="toc-text">自动装配</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#byName"><span class="toc-number">1.2.3.5.1.</span> <span class="toc-text">byName</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#byType"><span class="toc-number">1.2.3.5.2.</span> <span class="toc-text">byType</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#p-%E5%91%BD%E5%90%8D%E7%A9%BA%E9%97%B4-%E7%AE%80%E5%8C%96-set-%E6%B3%A8%E5%85%A5"><span class="toc-number">1.2.3.6.</span> <span class="toc-text">p 命名空间 - 简化 set 注入</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#c-%E5%91%BD%E5%90%8D%E7%A9%BA%E9%97%B4-%E7%AE%80%E5%8C%96%E6%9E%84%E9%80%A0%E6%B3%A8%E5%85%A5"><span class="toc-number">1.2.3.7.</span> <span class="toc-text">c  命名空间 - 简化构造注入</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#util-%E5%91%BD%E5%90%8D%E7%A9%BA%E9%97%B4-%E5%AE%9E%E7%8E%B0%E9%9B%86%E5%90%88%E5%A4%8D%E7%94%A8"><span class="toc-number">1.2.3.8.</span> <span class="toc-text">util 命名空间 - 实现集合复用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#context-%E5%91%BD%E5%90%8D%E7%A9%BA%E9%97%B4-%E5%BC%95%E5%85%A5%E5%A4%96%E9%83%A8%E6%96%87%E4%BB%B6"><span class="toc-number">1.2.3.9.</span> <span class="toc-text">context 命名空间 - 引入外部文件</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Bean-%E7%9A%84%E4%BD%9C%E7%94%A8%E5%9F%9F"><span class="toc-number">1.2.4.</span> <span class="toc-text">Bean 的作用域</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#singleton"><span class="toc-number">1.2.4.1.</span> <span class="toc-text">singleton</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#prototype"><span class="toc-number">1.2.4.2.</span> <span class="toc-text">prototype</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89-scope"><span class="toc-number">1.2.4.3.</span> <span class="toc-text">自定义 scope</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Bean-%E7%9A%84%E5%AE%9E%E4%BE%8B%E5%8C%96%E6%96%B9%E5%BC%8F"><span class="toc-number">1.2.5.</span> <span class="toc-text">Bean 的实例化方式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9E%84%E9%80%A0%E5%99%A8"><span class="toc-number">1.2.5.1.</span> <span class="toc-text">构造器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AE%80%E5%8D%95%E5%B7%A5%E5%8E%82"><span class="toc-number">1.2.5.2.</span> <span class="toc-text">简单工厂</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B7%A5%E5%8E%82%E6%96%B9%E6%B3%95"><span class="toc-number">1.2.5.3.</span> <span class="toc-text">工厂方法</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#FactoryBean"><span class="toc-number">1.2.5.3.1.</span> <span class="toc-text">FactoryBean</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8C%BA%E5%88%86-FactoryBean-%E5%92%8C-BeanFactory"><span class="toc-number">1.2.5.3.2.</span> <span class="toc-text">区分 FactoryBean 和 BeanFactory</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E9%80%9A%E8%BF%87-FactoryBean-%E5%AE%9E%E7%8E%B0%E8%87%AA%E5%AE%9A%E4%B9%89-Date"><span class="toc-number">1.2.5.3.3.</span> <span class="toc-text">通过 FactoryBean 实现自定义 Date</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Bean-%E7%9A%84%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F"><span class="toc-number">1.2.6.</span> <span class="toc-text">Bean 的生命周期</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%9D%E7%BA%A7%EF%BC%88%E4%BA%94%E6%AD%A5%EF%BC%89"><span class="toc-number">1.2.6.1.</span> <span class="toc-text">初级（五步）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%AD%E7%BA%A7-BeanPostProcessor%EF%BC%88%E4%B8%83%E6%AD%A5%EF%BC%89"><span class="toc-number">1.2.6.2.</span> <span class="toc-text">中级 BeanPostProcessor（七步）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%AB%98%E7%BA%A7%EF%BC%88%E5%8D%81%E6%AD%A5%EF%BC%89"><span class="toc-number">1.2.6.3.</span> <span class="toc-text">高级（十步）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Bean-%E7%9A%84%E4%BD%9C%E7%94%A8%E5%9F%9F%E7%BB%86%E8%8A%82"><span class="toc-number">1.2.6.4.</span> <span class="toc-text">Bean 的作用域细节</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#DefaultListBeanFactory"><span class="toc-number">1.2.6.5.</span> <span class="toc-text">DefaultListBeanFactory</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Bean-%E7%9A%84%E5%BE%AA%E7%8E%AF%E4%BE%9D%E8%B5%96%E9%97%AE%E9%A2%98"><span class="toc-number">1.2.7.</span> <span class="toc-text">Bean 的循环依赖问题</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90-%E2%80%93-%E4%B8%89%E7%BA%A7%E7%BC%93%E5%AD%98"><span class="toc-number">1.2.7.1.</span> <span class="toc-text">源码分析 – 三级缓存</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Spring-%E6%B3%A8%E8%A7%A3%E5%BC%8F%E5%BC%80%E5%8F%91"><span class="toc-number">1.3.</span> <span class="toc-text">Spring 注解式开发</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%84%E4%BB%B6%E6%89%AB%E6%8F%8F"><span class="toc-number">1.3.1.</span> <span class="toc-text">组件扫描</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A3%B0%E6%98%8E-Bean"><span class="toc-number">1.3.2.</span> <span class="toc-text">声明 Bean</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Component"><span class="toc-number">1.3.2.1.</span> <span class="toc-text">@Component</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95"><span class="toc-number">1.3.2.2.</span> <span class="toc-text">使用方法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%80%89%E6%8B%A9%E6%80%A7%E5%AE%9E%E4%BE%8B%E5%8C%96-Bean"><span class="toc-number">1.3.2.3.</span> <span class="toc-text">选择性实例化 Bean</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5-2"><span class="toc-number">1.3.3.</span> <span class="toc-text">依赖注入</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AE%80%E5%8D%95%E7%B1%BB%E5%9E%8B%E5%80%BC"><span class="toc-number">1.3.3.1.</span> <span class="toc-text">简单类型值</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Value"><span class="toc-number">1.3.3.1.1.</span> <span class="toc-text">@Value</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95-2"><span class="toc-number">1.3.3.1.2.</span> <span class="toc-text">使用方法</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9D%9E%E7%AE%80%E5%8D%95%E7%B1%BB%E5%9E%8B%E5%80%BC"><span class="toc-number">1.3.3.2.</span> <span class="toc-text">非简单类型值</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#AutoWired"><span class="toc-number">1.3.3.2.1.</span> <span class="toc-text">@AutoWired</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Qualifier"><span class="toc-number">1.3.3.2.2.</span> <span class="toc-text">@Qualifier</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Resource%EF%BC%88%E6%8E%A8%E8%8D%90%EF%BC%89"><span class="toc-number">1.3.3.2.3.</span> <span class="toc-text">@Resource（推荐）</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%86%E8%8A%82%E5%B0%8F%E7%BB%93"><span class="toc-number">1.3.3.3.</span> <span class="toc-text">细节小结</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Java-%E9%85%8D%E7%BD%AE%E7%B1%BB-%E5%85%A8%E6%B3%A8%E8%A7%A3%E5%BC%80%E5%8F%91"><span class="toc-number">1.3.4.</span> <span class="toc-text">Java 配置类 - 全注解开发</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#context-%E5%91%BD%E5%90%8D%E7%A9%BA%E9%97%B4%E7%9B%B8%E5%85%B3"><span class="toc-number">1.3.4.1.</span> <span class="toc-text">context 命名空间相关</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#ComponentScan"><span class="toc-number">1.3.4.1.1.</span> <span class="toc-text">@ComponentScan</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#PropertySource"><span class="toc-number">1.3.4.1.2.</span> <span class="toc-text">@PropertySource</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#bean-%E6%A0%87%E7%AD%BE%E7%9B%B8%E5%85%B3"><span class="toc-number">1.3.4.2.</span> <span class="toc-text">&lt;bean&gt; 标签相关</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Bean"><span class="toc-number">1.3.4.2.1.</span> <span class="toc-text">@Bean</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Scope"><span class="toc-number">1.3.4.2.2.</span> <span class="toc-text">@Scope</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Import"><span class="toc-number">1.3.4.3.</span> <span class="toc-text">@Import</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9D%A1%E4%BB%B6%E6%B3%A8%E5%86%8C-bean"><span class="toc-number">1.3.4.4.</span> <span class="toc-text">条件注册 bean</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Conditional"><span class="toc-number">1.3.4.4.1.</span> <span class="toc-text">@Conditional</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="toc-number">1.3.4.4.2.</span> <span class="toc-text">应用场景</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Spring-%E4%B8%AD%E7%9A%84%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F"><span class="toc-number">1.4.</span> <span class="toc-text">Spring 中的设计模式</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#GoF-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%BB%8B%E7%BB%8D"><span class="toc-number">1.4.1.</span> <span class="toc-text">GoF 设计模式介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F"><span class="toc-number">1.4.2.</span> <span class="toc-text">工厂模式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%89%E7%A7%8D%E5%BD%A2%E5%BC%8F"><span class="toc-number">1.4.2.1.</span> <span class="toc-text">三种形式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AE%80%E5%8D%95%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F%EF%BC%88%E9%9D%99%E6%80%81%E5%B7%A5%E5%8E%82%E6%96%B9%E6%B3%95%E6%A8%A1%E5%BC%8F%EF%BC%89"><span class="toc-number">1.4.2.2.</span> <span class="toc-text">简单工厂模式（静态工厂方法模式）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B7%A5%E5%8E%82%E6%96%B9%E6%B3%95%E6%A8%A1%E5%BC%8F"><span class="toc-number">1.4.2.3.</span> <span class="toc-text">工厂方法模式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8A%BD%E8%B1%A1%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F"><span class="toc-number">1.4.2.4.</span> <span class="toc-text">抽象工厂模式</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%A3%E7%90%86%E6%A8%A1%E5%BC%8F"><span class="toc-number">1.4.3.</span> <span class="toc-text">代理模式</span></a></li></ol></li></ol></li></ol></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2024 By Eunoiay</div><div class="footer_custom_text">欢迎来到 <a target="_blank" rel="noopener" href="https://eunoiay.github.io/">Eunoiayの博客</a>!</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=4.13.0"></script><script src="/js/main.js?v=4.13.0"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.33/dist/fancybox/fancybox.umd.min.js"></script><div class="js-pjax"></div></div></body></html>